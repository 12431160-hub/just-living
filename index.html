<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Just living</title>
<style>
body, html {
    height: 100%;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #f0f0f0;
}
#drawing-area {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}
#drawCanvas {
    display: block;
}
#resetButton {
    position: absolute;
    right: 20px;
    bottom: 20px;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #ff6347;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
#resetButton:hover { background-color: #ff4500; }
</style>
</head>
<body>
<div id="drawing-area">
  <canvas id="drawCanvas"></canvas>
  <button id="resetButton">Clear</button>
</div>

<audio id="bgm" src="bgm.mp3" autoplay loop></audio>

<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const resetButton = document.getElementById('resetButton');

const bgm = document.getElementById('bgm');
document.body.addEventListener('click', () => { if (bgm.paused) bgm.play(); }, { once: true });

const backgroundImage = new Image();
backgroundImage.src = window.innerHeight > window.innerWidth ? 'background2.JPG' : 'background.PNG';
let bgLoaded = false;
backgroundImage.onload = () => { bgLoaded = true; drawBackground(); };

function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    drawBackground();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function drawBackground(){
    if (!bgLoaded) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(backgroundImage, 0, 0, window.innerWidth, window.innerHeight);
}

let drawing = false;
let x = 0, y = 0;

function getPos(e){
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches && e.touches[0];
    return { x: (touch ? touch.clientX : e.clientX) - rect.left, y: (touch ? touch.clientY : e.clientY) - rect.top };
}

function startDrawing(e){ e.preventDefault(); drawing = true; const pos = getPos(e); x = pos.x; y = pos.y; }
function stopDrawing(){ drawing = false; }

function draw(e){
    if(!drawing) return;
    e.preventDefault();
    const pos = getPos(e);
    const newX = pos.x, newY = pos.y;

    ctx.strokeStyle = 'rgba(0,0,0,0)';
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(newX, newY);
    ctx.stroke();

    x = newX;
    y = newY;

    // 家の出現確率を0.2
    if(Math.random() < 0.2){ spawnBuilding(newX, newY); }
}

function spawnBuilding(px, py){
    const files = ['building.png','building2.png','building3.png','building4.png'];
    const img = new Image();
    const chosen = files[Math.floor(Math.random() * files.length)];
    img.src = chosen;

    img.onload = () => {
        const baseW = 150, baseH = 200;
        const scale = Math.min(window.innerWidth / 800, 1);
        let w = baseW * scale;
        let h = baseH * scale;
        if(chosen === 'building4.png') h *= 0.8;
        ctx.drawImage(img, px - w/2, py - h/2, w, h);
    };
}

resetButton.addEventListener('click', drawBackground);
canvas.addEventListener('mousedown', startDrawing);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', stopDrawing);
canvas.addEventListener('mouseleave', stopDrawing);
canvas.addEventListener('touchstart', startDrawing);
canvas.addEventListener('touchmove', draw);
canvas.addEventListener('touchend', stopDrawing);
</script>
</body>
</html>
